<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa Interativo - Turismo Acessível</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    <style>
      .gradient-bg {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      }
      #map {
        height: 60vh;
        width: 100%;
      }
      .filter-btn {
        transition: all 0.3s ease;
      }
      .filter-btn:hover {
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body class="bg-gray-50 font-sans">
    <!-- Navbar (copiada do index.html) -->
    <nav class="gradient-bg text-white shadow-lg">
      <div
        class="container mx-auto px-4 py-4 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2">
          <i data-feather="map" class="w-8 h-8"></i>
          <span class="text-xl font-bold">Turismo Acessível</span>
        </div>
        <div class="hidden md:flex space-x-6">
          <a href="/" class="hover:text-blue-200 transition">Início</a>
          <a href="/mapa_folium" class="hover:text-blue-200 transition">Mapa</a>
          <a href="/destinos" class="hover:text-blue-200 transition"
            >Destinos</a
          >
          <a href="/sobre" class="hover:text-blue-200 transition">Sobre Nós</a>
          <a href="/contato" class="hover:text-blue-200 transition">Contato</a>
        </div>
        <button class="md:hidden" id="menu-btn">
          <i data-feather="menu" class="w-6 h-6"></i>
        </button>
      </div>
      <!-- Mobile Menu -->
      <div class="md:hidden hidden px-4 pb-4" id="mobile-menu">
        <a href="/" class="block py-2 hover:text-blue-200">Início</a>
        <a href="/mapa_folium" class="block py-2 hover:text-blue-200">Mapa</a>
        <a href="/destinos" class="block py-2 hover:text-blue-200">Destinos</a>
        <a href="/sobre" class="block py-2 hover:text-blue-200">Sobre Nós</a>
        <a href="/contato" class="block py-2 hover:text-blue-200">Contato</a>
      </div>
    </nav>
    <script>
      document
        .getElementById("menu-btn")
        .addEventListener("click", function () {
          const menu = document.getElementById("mobile-menu");
          if (menu.classList.contains("hidden")) {
            menu.classList.remove("hidden");
            feather.replace();
          } else {
            menu.classList.add("hidden");
          }
        });
      feather.replace();
    </script>

    <!-- Map Search Section -->
    <section class="py-12 bg-white">
      <div class="container mx-auto px-4">
        <h1 class="text-3xl font-bold mb-6 text-center">
          Mapa de Acessibilidade
        </h1>
        <!-- Search Bar -->
        <div class="max-w-3xl mx-auto mb-8" data-aos="fade-up">
          <div class="relative">
            <input
              type="text"
              id="search-input"
              class="w-full border border-gray-300 rounded-lg py-3 px-4 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Buscar cidade, atração ou endereço..."
            />
            <span
              class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"
            >
              <i data-feather="search"></i>
            </span>
          </div>
        </div>
        <!-- Map Container -->
        <div id="map" class="rounded-lg shadow-lg mb-8"></div>
        <!-- Filtros dinâmicos -->
        <div class="flex flex-wrap justify-center gap-4 mb-8">
          <label for="filtro-cidade">Cidade:</label>
          <select id="filtro-cidade" class="border rounded px-2 py-1">
            <option value="todas">Todas</option>
          </select>
          <label for="filtro-acess">Acessibilidade:</label>
          <select id="filtro-acess" class="border rounded px-2 py-1">
            <option value="todas">Todas</option>
            <option value="Sim">Sim</option>
            <option value="Parcial">Parcial</option>
            <option value="Não">Não</option>
          </select>
        </div>
      </div>
    </section>
    <!-- ...restante do HTML do mapa... -->
    <script>
      // Mobile menu toggle
      document
        .getElementById("menu-btn")
        .addEventListener("click", function () {
          const menu = document.getElementById("mobile-menu");
          if (menu.classList.contains("hidden")) {
            menu.classList.remove("hidden");
            feather.replace();
          } else {
            menu.classList.add("hidden");
          }
        });

      // Initialize AOS animation library
      AOS.init({
        duration: 800,
        easing: "ease-in-out",
        once: true,
      });

      // Replace all feather icons
      feather.replace();

      // Google Maps + API Flask integração refinada
      function getCoords(atracao) {
        // Coordenadas reais ou aproximadas para exemplos de Angola
        const coordsMap = {
          "Fortaleza de São Miguel": { lat: -8.8127, lng: 13.2344 },
          "Ilha do Mussulo": { lat: -9.0456, lng: 13.1217 },
          "Miradouro da Lua": { lat: -9.6975, lng: 13.2731 },
          "Museu Nacional de Antropologia": { lat: -8.8137, lng: 13.2342 },
          "Parque Nacional da Kissama": { lat: -9.5833, lng: 13.0833 },
        };
        return coordsMap[atracao.nome] || { lat: -8.8383, lng: 13.2344 };
      }
      function getMarkerColor(acessibilidade) {
        if (acessibilidade === "Sim")
          return "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
        if (acessibilidade === "Parcial")
          return "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png";
        return "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
      }
      // Filtros dinâmicos
      let atracoesCache = [];
      function renderMarkers(map, atracoes) {
        // Remove todos os marcadores antigos
        if (window.markers) window.markers.forEach((m) => m.setMap(null));
        window.markers = [];
        atracoes.forEach((atracao) => {
          const coords = getCoords(atracao);
          const marker = new google.maps.Marker({
            position: coords,
            map,
            title: atracao.nome + " - " + atracao.acessibilidade,
            icon: getMarkerColor(atracao.acessibilidade),
          });
          const info = `<b>${atracao.nome}</b><br>${atracao.endereco}<br>${atracao.cidade}<br>Acessibilidade: <b>${atracao.acessibilidade}</b><br>Tipo: ${atracao.tipo}`;
          const infowindow = new google.maps.InfoWindow({ content: info });
          marker.addListener("click", () => infowindow.open(map, marker));
          window.markers.push(marker);
        });
      }
      function applyFilters(map) {
        const cidade = document.getElementById("filtro-cidade").value;
        const acess = document.getElementById("filtro-acess").value;
        const busca = document
          .getElementById("search-input")
          .value.trim()
          .toLowerCase();
        let filtradas = atracoesCache;
        if (cidade !== "todas")
          filtradas = filtradas.filter((a) => a.cidade === cidade);
        if (acess !== "todas")
          filtradas = filtradas.filter((a) => a.acessibilidade === acess);
        if (busca)
          filtradas = filtradas.filter((a) =>
            a.nome.toLowerCase().includes(busca)
          );
        renderMarkers(map, filtradas);
      }
      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: -8.8383, lng: 13.2344 },
          zoom: 7,
        });
        fetch("/api/atracoes")
          .then((response) => response.json())
          .then((atracoes) => {
            atracoesCache = atracoes;
            // Preencher filtros
            const cidades = Array.from(new Set(atracoes.map((a) => a.cidade)));
            const filtroCidade = document.getElementById("filtro-cidade");
            cidades.forEach((c) => {
              const opt = document.createElement("option");
              opt.value = c;
              opt.textContent = c;
              filtroCidade.appendChild(opt);
            });
            // Evento filtros
            document
              .getElementById("filtro-cidade")
              .addEventListener("change", () => applyFilters(map));
            document
              .getElementById("filtro-acess")
              .addEventListener("change", () => applyFilters(map));
            document
              .getElementById("search-input")
              .addEventListener("input", () => applyFilters(map));
            renderMarkers(map, atracoes);
          });
      }
      window.initMap = initMap;
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
